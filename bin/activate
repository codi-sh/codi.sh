#!/bin/bash
# Source https://github.com/cadorn/bash.origin
if [ ! -f "$HOME/.bash.origin" ]; then
	if [ -f "bin/install" ]; then
		bin/install
	else
		echo "ERROR: Run 'bin/install' first to install 'bash.origin'!"
		exit 1;
	fi
fi
. "$HOME/.bash.origin"
function init {
	eval BO_SELF_BASH_SOURCE="$BO_READ_SELF_BASH_SOURCE"
	BO_deriveSelfDir ___TMP___ "$BO_SELF_BASH_SOURCE"
	local __BO_DIR__="$___TMP___"

	SYSTEM_ROOT_PATH="$( dirname $__BO_DIR__ )"
	SYSTEM_NAME="$( basename $SYSTEM_ROOT_PATH )"

	function customizePrompt {
		BO_callPlugin "bash.origin.prompt" setPrompt "workspace" "$SYSTEM_ROOT_PATH"
	}

	# TODO: Relocate into plugin and load based on mapping.
	function aliasHome {
		alias home="cd $SYSTEM_ROOT_PATH"
	}

	# TODO: Relocate into plugin and load based on mapping.
	function aliasHelp {
		alias help='echo "$(printHelp)"'
	}

	# TODO: Read pre-generated help file or generate from metadata if not found.
	function printHelp {
		echo " "
		echo "  Global commands:"
		echo " "
		echo "    help - Shows this help"
		echo "    home - Changes directories back to the root of the system ($SYSTEM_ROOT_PATH)"
		echo "    reload - Reload the current environment (source bin/activate)"
		echo "    demo - Runs all demos (bin/demo)"
		echo "    test - Runs all tests (bin/test)"
		echo " "
		echo "  Located commands:"
		echo " "
		echo "    bin/test"
		echo "    bin/demo"
		echo " "
	}

	function aliasSystemBinaries {
		alias demo="$SYSTEM_ROOT_PATH/bin/demo"
		alias test="$SYSTEM_ROOT_PATH/bin/test"
		alias reload="source $SYSTEM_ROOT_PATH/bin/activate"
	}

	function printWelcome {
		echo " "
		echo "|------------------------------------------------------------|"
		echo "| Welcome to codi.sh! Below is a summary to get you started. |"
		echo "|------------------------------------------------------------|"
		printHelp
	}

	customizePrompt
	aliasHome
	aliasHelp
	aliasSystemBinaries

	printWelcome
}
init